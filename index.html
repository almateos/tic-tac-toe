<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/assets/css/style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="assets/js/require.js"></script>
    <script src="assets/js/gamecs.min.js"></script>
    <script src="assets/js/BIG.js"></script>
    <script>
        require(['BIG'], function(BIG) {
            window.BIG = BIG;
            BIG.init({
                        api_key: "<%= api_key %>",
                        player_id: "<%= player_id %>",
                        player_token: "<%= player_token %>"
                    },
                    function(err, data) {
                        console.log('api.init:', err, data);
                        if(err)
                            console.log(err);
                        else
                            user = data.response;

                        data2 = {
                            lobbies: [
                                { name: 'free',   cost: null},
                                { name: 'bronze', cost: 100},
                                { name: 'silver', cost: 250},
                                { name: 'gold',   cost: 500}
                            ],
                            user: { balance: user.real_balance}
                        };

                        BIG.ui('lobby', '#lobby',  data2);
                        BIG.ui('bank', '#bank', { balance: user.real_balance, player_id: user.id });


                        // Disconnect user (from api and lobbies)
                        window.onbeforeunload = function (e) {
                            BIG.disconnect('player_1', function(err, data) { console.log(err, data) } );
                        }

                        //BIG.ui({type:'status', element: '#status'}, callback);
                    })
        })
    </script>
</head>
<body>
    <div class="cut-point">
        <div class="back2">
            <div class="navbar">
                <span id="profile">
                  <span>Hello <span id='username'><%= player_id %></span> ! </span>
                </span>
                    <span class="add-credits pull-right">
                    <span id="bank"></span>
                </span>
            </div>
            <div id="content1">
              <div id="rules">
                  In our special Tic Tac Toe, you can play for fun as usual... <strong>or you can bet your rubies !</strong><br /><br /><br />
                  <span>How does it works ? </span><p class="rules-explanation">Playing in a 100 rubies lobby means you bet 100 rubies on your victory and your opponent will do the same. The winner of the game wins the 200 rubies pot ! In the end, exchange your rubies for regular hard currency game, boosters, virtuals items, etc.</p>
                  <span>What do you have to do now ? </span><p class="rules-explanation">First, you have to buy rubies in our special shop (70% of the amount comes back to the publisher). Then, you just have to click on the lobby you want to play in and our matchmaking will find the right opponent for you. If you are connected to several lobbies, you will be matched with the first relevant opponent.</p>
                  <span>Click to join a lobby :</span>
              </div>
              <div id="lobby"></div>
            </div>
            <div id="content2" style="display:none">
                  <div id="gjs-loader"> Loading...  </div>
                  <canvas id="gjs-canvas"></canvas>
            </div>
            <div><ul id='notifications'></ul></div>
        </div>
    </div>
</body>
<script src="build/main.js"></script>
</html>
