(function(){var e=[].slice;define("utils/objects",["require"],function(t){var n;return n=function(){function t(){}return t.extend=function(e,t){var n;if(e===void 0)throw new Error("unknown subClass");if(t===void 0)throw new Error("unknown superClass");return n=new Function,n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superClass=t.prototype,e.superConstructor=t},t.merge=function(){var t,n,r,i,s,o,u,a,f;t=1<=arguments.length?e.call(arguments,0):[],s={};for(n=o=f=t.length;f<=0?o<0:o>0;n=f<=0?++o:--o){r=t[n-1];for(u=0,a=r.length;u<a;u++)i=r[u],s[i]=r[i]}return s},t.keys=function(e){var t,n;if(Object.keys)return Object.keys(e);n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n},t.accessor=function(e,t,n,r){if(Object.defineProperty!==void 0)return Object.defineProperty(e,t,{get:n,set:r});if(Object.prototype.__defineGetter__!==void 0){e.__defineGetter__(t,n);if(r)return e.__defineSetter__(t,r)}},t.accessors=function(e,n){return t.keys(n).forEach(function(r){return t.accessor(e,r,n[r].get,n[r].set)})},t}()})}).call(this),function(){var e=[].slice;define("rect",["require","utils/objects"],function(t){var n,r,i,s;return n=t("utils/objects"),s=!1,i=function(){if(!s)return s=!0,n.accessors(r.prototype,{bottom:{get:function(){return this.top+this.height},set:function(e){this.top=e-this.height}},right:{get:function(){return this.left+this.width},set:function(e){this.left=e-this.width}},center:{get:function(){return[this.left+this.width/2|0,this.top+this.height/2|0]},set:function(){var t;t=1<=arguments.length?e.call(arguments,0):[],t=r.normalizeArguments.apply(this,t),this.left=t.left-this.width/2|0,this.top=t.top-this.height/2|0}},topleft:{get:function(){return[this.left,this.top]},set:function(){var t;t=1<=arguments.length?e.call(arguments,0):[],t=r.normalizeArguments.apply(this,t),this.left=t.left,this.top=t.top}},bottomleft:{get:function(){return[this.left,this.bottom]},set:function(){var t;t=1<=arguments.length?e.call(arguments,0):[],t=r.normalizeArguments.apply(this,t),this.left=t.left,this.bottom=t.top}},topright:{get:function(){return[this.right,this.top]},set:function(){var t;t=1<=arguments.length?e.call(arguments,0):[],t=r.normalizeArguments.apply(this,t),this.right=t.left,this.top=t.top}},bottomright:{get:function(){return[this.right,this.bottom]},set:function(){var t;t=1<=arguments.length?e.call(arguments,0):[],t=r.normalizeArguments.apply(this,t),this.right=t.left,this.bottom=t.top}},x:{get:function(){return this.left},set:function(e){this.left=e}},y:{get:function(){return this.top},set:function(e){this.top=e}}})},r=function(){function t(){var n;n=1<=arguments.length?e.call(arguments,0):[],n=t.normalizeArguments.apply(this,n),this.init(n.left,n.top,n.width,n.height),i()}return t.prototype.init=function(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r},t.normalizeArguments=function(){var n,r;n=1<=arguments.length?e.call(arguments,0):[];if(n.length===2)n[0]instanceof Array&&n[1]instanceof Array?r=[n[0][0],n[0][1],n[1][0],n[1][1]]:r=[n[0],n[1]];else if(n.length===1&&n[0]instanceof Array)r=[n[0][0],n[0][1],n[0][2],n[0][3]];else if(n.length===1&&n[0]instanceof t)r=[n[0].left,n[0].top,n[0].width,n[0].height];else{if(n.length!==4)throw new Error("not a valid rectangle specification");r=[n[0],n[1],n[2],n[3]]}return{left:r[0]||0,top:r[1]||0,width:r[2]||0,height:r[3]||0}},t.prototype.move=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n=t.normalizeArguments.apply(this,n),new t(this.left+n.left,this.top+n.top,this.width,this.height)},t.prototype.moveIp=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n=t.normalizeArguments.apply(this,n),this.left+=n.left,this.top+=n.top},t.prototype.clip=function(e){var n,r,i,s;return this.collideRect(e)?(this.left>=e.left&&this.left<e.right?i=this.left:e.left>=this.left&&e.left<this.right&&(i=e.left),this.right>e.left&&this.right<=e.right?r=this.right-i:e.right>this.left&&e.right<=this.right&&(r=e.right-i),this.top>=e.top&&this.top<e.bottom?s=this.top:e.top>=this.top&&e.top<this.bottom&&(s=e.top),this.bottom>e.top&&this.bottom<=e.bottom?n=this.bottom-s:e.bottom>this.top&&e.bottom<=this.bottom&&(n=e.bottom-s),new t(i,s,r,n)):new t(0,0,0,0)},t.prototype.union=function(e){var n,r,i,s;return i=Math.min(this.left,e.left),s=Math.min(this.top,e.top),r=Math.max(this.right,e.right)-i,n=Math.max(this.bottom,e.bottom)-s,new t(i,s,r,n)},t.prototype.inflate=function(e,t){var n;return n=this.clone(),n.inflateIp(e,t),n},t.prototype.inflateIp=function(e,t){return this.left-=Math.floor(e/2),this.top-=Math.floor(t/2),this.width+=e,this.height+=t},t.prototype.collidePoint=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n=t.normalizeArguments.apply(this,n),this.left<=n.left&&n.left<=this.right&&this.top<=n.top&&n.top<=this.bottom},t.prototype.collideRect=function(e){return!(this.left>e.right||this.right<e.left||this.top>e.bottom||this.bottom<e.top)},t.prototype.collideLine=function(e,t){var n,r,i,s,o,u,a,f,l;return u=e[0],f=e[1],a=t[0],l=t[1],n=function(e){var t,n;return t=e[0],n=e[1],(l-f)*t+(u-a)*n+(a*f-u*l)},o=[[this.left,this.top],[this.left,this.bottom],[this.right,this.top],[this.right,this.bottom]].map(n),r=!0,i=!0,s=!0,o.forEach(function(e){if(e>0)return i=!1;if(e<0)return r=!1;if(e===0)return s=!1},this),(r||i)&&s?!1:!(u>this.right&&a>this.right||u<this.left&&a<this.left||f<this.top&&l<this.top||f>this.bottom&&l>this.bottom)},t.prototype.toString=function(){return["[",this.left,",",this.top,"]"," [",this.width,",",this.height,"]"].join("")},t.prototype.clone=function(){return new t(this)},t}()})}.call(this),function(){var e=[].slice;define("surface",["require","rect","utils/objects"],function(t){var n,r,i,s;return r=t("rect"),n=t("utils/objects"),s=!1,i=function(){function t(){var i,o,u;i=1<=arguments.length?e.call(arguments,0):[],s||(s=!0,n.accessors(t.prototype,{rect:{get:function(){return this.getRect()}},context:{get:function(){return this._context}},canvas:{get:function(){return this._canvas}}})),i=r.normalizeArguments.apply(this,i),u=i.left,o=i.top,i.length===1&&i[0]instanceof r&&(u=i.width,o=i.height),this._matrix=[1,0,0,1,0,0],this._canvas=document.createElement("canvas"),this._canvas.width=u,this._canvas.height=o,this._blitAlpha=1,this._context=this._canvas.getContext("2d"),this._noSmooth()}return t.prototype._noSmooth=function(){this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1;return},t.prototype.blit=function(e,t,n,i){var s,o,u,a;t instanceof r?(o=t.clone(),a=e.getSize(),o.width||(o.width=a[0]),o.height||(o.height=a[1])):t&&t instanceof Array&&(t.length=2)?o=new r(t,e.getSize()):o=new r([0,0],e.getSize()),i=i||"source-over",n instanceof r?s=n:n&&n instanceof Array&&(n.length=2)?(u=e.getSize(),s=new r(n,[u[0]-n[0],u[1]-n[1]])):s=new r([0,0],e.getSize());if(isNaN(o.left)||isNaN(o.top)||isNaN(o.width)||isNaN(o.height))throw new Error("[blit] bad parameters, destination is "+o);this.context.save(),this.context.globalCompositeOperation=i,this.context.translate(o.left,o.top),this.context.globalAlpha=e._blitAlpha,this.context.drawImage(e.canvas,s.left,s.top,s.width,s.height,0,0,o.width,o.height),this.context.restore()},t.prototype.getSize=function(){return[this.canvas.width,this.canvas.height]},t.prototype.getRect=function(){return new r([0,0],this.getSize())},t.prototype.fill=function(e,t){this.context.save(),this.context.fillStyle=e||"#000000",t===void 0&&(t=new r(0,0,this.canvas.width,this.canvas.height)),this.context.fillRect(t.left,t.top,t.width,t.height),this.context.restore()},t.prototype.clear=function(e){var t;t=this.getSize(),e=e||new r(0,0,t[0],t[1]),this.context.clearRect(e.left,e.top,e.width,e.height)},t.prototype.clone=function(){var e;return e=new t(this.getRect()),e.blit(this),e},t.prototype.getAlpha=function(){return 1-this._blitAlpha},t.prototype.setAlpha=function(e){if(isNaN(e)||e<0||e>1)return;return this._blitAlpha=1-e,1-this._blitAlpha},t.prototype.getImageData=function(){var e;return e=this.getSize(),this.context.getImageData(0,0,e[0],e[1])},t}()})}.call(this),function(){define("display",["require","surface"],function(e){var t,n,r,i,s,o,u,a;return o=e("surface"),t="gjs-canvas",i="gjs-loader",s=null,n=2,a=!0,u=function(){return document.getElementById(t)},r=function(){function e(){}return e.init=function(){var e,n;n=null,(n=u())===null&&(n=document.createElement("canvas"),n.setAttribute("id",t),document.body.appendChild(n)),n.setAttribute("tabindex",1),n.focus(),e=document.getElementById("gjs-loader");if(e)return e.style.display="none"},e._hasFocus=function(){return document.activeElement===u()},e._isSmoothingEnabled=function(){return a===!0},e.setMode=function(e,t){var r;return s=null,r=u(),r.width=e[0],r.height=e[1],a=t!==n,this.getSurface()},e.setCaption=function(e,t){return document.title=e},e._getCanvasOffset=function(){var e;return e=u().getBoundingClientRect(),[e.left,e.top]},e.getSurface=function(){var e;return s===null&&(e=u(),s=new o([e.clientWidth,e.clientHeight]),s._canvas=e,s._context=e.getContext("2d")),s},e}()})}.call(this),function(){define("draw",["require"],function(e){var t;return t=function(){function e(){}return e.line=function(e,t,n,r,i){var s;s=e.context,s.save(),s.beginPath(),s.strokeStyle=t,s.lineWidth=i||1,s.moveTo(n[0],n[1]),s.lineTo(r[0],r[1]),s.stroke(),s.restore()},e.lines=function(e,t,n,r,i){var s;n=n||!1,s=e.context,s.save(),s.beginPath(),s.strokeStyle=s.fillStyle=t,s.lineWidth=i||1,r.forEach(function(e,t){return t===0?s.moveTo(e[0],e[1]):s.lineTo(e[0],e[1])}),n&&s.lineTo(r[0][0],r[0][1]),s.stroke(),s.restore()},e.circle=function(e,t,n,r,i){var s;if(!r)throw new Error("[circle] radius required argument");if(!n||!(n instanceof Array))throw new Error("[circle] pos must be given & array"+n);s=e.context,s.save(),s.beginPath(),s.strokeStyle=s.fillStyle=t,s.lineWidth=i||1,s.arc(n[0],n[1],r,0,2*Math.PI,!0),i===void 0||i===0?s.fill():s.stroke(),s.restore()},e.rect=function(e,t,n,r){var i;return i=e.context,i.save(),i.beginPath(),i.strokeStyle=i.fillStyle=t,isNaN(r)||r===0?i.fillRect(n.left,n.top,n.width,n.height):(i.lineWidth=r||1,i.strokeRect(n.left,n.top,n.width,n.height)),i.restore()},e.arc=function(e,t,n,r,i,s){var o;return o=e.context,o.save(),o.beginPath(),o.strokeStyle=o.fillStyle=t,o.arc(n.center[0],n.center[1],n.width/2,r*(Math.PI/180),i*(Math.PI/180),!1),isNaN(s)||s===0?o.fill():(o.lineWidth=s||1,o.stroke()),o.restore()},e.polygon=function(e,t,n,r){var i;return i=e.context,i.save(),i.fillStyle=i.strokeStyle=t,i.beginPath(),n.forEach(function(e,t){return t===0?i.moveTo(e[0],e[1]):i.lineTo(e[0],e[1])}),i.closePath(),isNaN(r)||r===0?i.fill():(i.lineWidth=r||1,i.stroke()),i.restore()},e}()})}.call(this),function(){define("key",["require","display"],function(e){var t,n,r;return t=e("display"),r=[],n=function(){function e(){}return e.K_LEFT=37,e.K_UP=38,e.K_RIGHT=39,e.K_DOWN=40,e.K_BACKSPACE=8,e.K_TAB=9,e.K_ENTER=13,e.K_SHIFT=16,e.K_CTRL=17,e.K_ALT=18,e.K_ESC=27,e.K_SPACE=32,e.K_0=48,e.K_1=49,e.K_2=50,e.K_3=51,e.K_4=52,e.K_5=53,e.K_6=54,e.K_7=55,e.K_8=56,e.K_9=57,e.K_a=65,e.K_b=66,e.K_c=67,e.K_d=68,e.K_e=69,e.K_f=70,e.K_g=71,e.K_h=72,e.K_i=73,e.K_j=74,e.K_k=75,e.K_l=76,e.K_m=77,e.K_n=78,e.K_o=79,e.K_p=80,e.K_q=81,e.K_r=82,e.K_s=83,e.K_t=84,e.K_u=85,e.K_v=86,e.K_w=87,e.K_x=88,e.K_y=89,e.K_z=90,e.K_KP1=97,e.K_KP2=98,e.K_KP3=99,e.K_KP4=100,e.K_KP5=101,e.K_KP6=102,e.K_KP7=103,e.K_KP8=104,e.K_KP9=105,e.NOEVENT=0,e.NUMEVENTS=32e3,e.QUIT=0,e.KEY_DOWN=1,e.KEY_UP=2,e.MOUSE_MOTION=3,e.MOUSE_UP=4,e.MOUSE_DOWN=5,e.MOUSE_WHEEL=6,e.USEREVENT=2e3,e.QUEUE=[],e.get=function(t){var n;return t===void 0?e.QUEUE.splice(0,e.QUEUE.length):(t instanceof Array||(t=[t]),n=[],e.QUEUE=e.QUEUE.filter(function(e){return t.indexOf(e.type)===-1?!0:(n.push(e),!1)}),n)},e.poll=function(){return e.QUEUE.pop()},e.post=function(t){return e.QUEUE.push(t)},e.clear=function(){return e.QUEUE=[]},e.Event=function(){return this.type=null,this.key=null,this.rel=null,this.button=null,this.pos=null},e.init=function(){var e;return r=[],e=t.getSurface()._canvas,document.addEventListener("mousedown",this.onMouseDown,!1),document.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),e.addEventListener("mousemove",this.onMouseMove,!1),e.addEventListener("mousewheel",this.onMouseScroll,!1),e.addEventListener("DOMMouseScroll",this.onMouseScroll,!1),e.addEventListener("beforeunload",this.onBeforeUnload,!1)},e.onMouseDown=function(n){var r;return r=t._getCanvasOffset(),e.QUEUE.push({type:e.MOUSE_DOWN,pos:[n.clientX-r[0],n.clientY-r[1]],button:n.button,shiftKey:n.shiftKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey})},e.onMouseUp=function(n){var r;return r=t._getCanvasOffset(),e.QUEUE.push({type:e.MOUSE_UP,pos:[n.clientX-r[0],n.clientY-r[1]],button:n.button,shiftKey:n.shiftKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey})},e.onKeyDown=function(n){var r;r=n.keyCode||n.which,e.QUEUE.push({type:e.KEY_DOWN,key:r,shiftKey:n.shiftKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey});if(t._hasFocus()&&!n.ctrlKey&&!n.metaKey&&(r>=e.K_LEFT&&r<=e.K_DOWN||r>=e.K_0&&r<=e.K_z||r>=e.K_KP1&&r<=e.K_KP9||r===e.K_SPACE||r===e.K_TAB||r===e.K_ENTER)||r===e.K_ALT||r===e.K_BACKSPACE)return n.preventDefault()},e.onKeyUp=function(t){return e.QUEUE.push({type:e.KEY_UP,key:t.keyCode,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey})},e.onMouseMove=function(n){var i,s,o;return i=t._getCanvasOffset(),s=[n.clientX-i[0],n.clientY-i[1]],o=[],r.length&&(o=[r[0]-s[0],r[1]-s[1]]),e.QUEUE.push({type:e.MOUSE_MOTION,pos:s,rel:o,buttons:null,timestamp:n.timeStamp}),r=s},e.onMouseScroll=function(n){var r,i;return r=t._getCanvasOffset(),i=[n.clientX-r[0],n.clientY-r[1]],e.QUEUE.push({type:e.MOUSE_WHEEL,pos:i,delta:n.detail||-n.wheelDeltaY/40})},e.onBeforeUnload=function(t){return e.QUEUE.push({type:e.QUIT})},e}()})}.call(this),function(){define("font",["require","surface","utils/objects"],function(e){var t,n,r;return r=e("surface"),n=e("utils/objects"),t=function(){function e(e,t){return this.sampleSurface=new r([10,10]),this.sampleSurface.context.font=e,this.sampleSurface.context.textAlign="start",this.sampleSurface.context.textBaseline="bottom",this.backgroundColor=t||!1,this}return e.prototype.render=function(e,t){var n,i,s;return i=this.size(e),s=new r(i),n=s.context,n.save(),this.backgroundColor&&(n.fillStyle=this.backgroundColor,n.fillRect(0,0,s.rect.width,s.rect.height)),n.font=this.sampleSurface.context.font,n.textBaseline=this.sampleSurface.context.textBaseline,n.textAlign=this.sampleSurface.context.textAlign,n.fillStyle=n.strokeStyle=t||"#000000",n.fillText(e,0,s.rect.height,s.rect.width),n.restore(),s},e.prototype.size=function(e){var t;return t=this.sampleSurface.context.measureText(e),[t.width,this.fontHeight]},n.accessors(e.prototype,{fontHeight:{get:function(){return this.sampleSurface.context.measureText("M").width*1.5}}}),e}()})}.call(this),function(){define("http",["require"],function(require){var Http;return Http=function(){function Http(){}return Http.Response=function(){throw this.getResponseHeader=function(e){},new Error("response class not instantiable")},Http.ajax=function(e,t,n,r){var i;return n=n||null,i=new XMLHttpRequest,i.open(e,t,!1),r&&i.setRequestHeader("Accept",r),n instanceof Object&&(n=JSON.stringify(n),i.setRequestHeader("Content-Type","application/json")),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(n),i},Http.get=function(e){return this.ajax("GET",e)},Http.post=function(e,t,n){return this.ajax("POST",e,t,n)},Http.stringify=function(response){return eval("("+response.responseText+")")},Http.ajaxBaseHref=function(){return window.$g&&window.$g.ajaxBaseHref||"./"},Http.load=function(e){return this.stringify(this.get(this.ajaxBaseHref()+e))},Http.save=function(e,t,n){return this.stringify(this.post(this.ajaxBaseHref()+e,{payload:t},n))},Http}()})}.call(this),function(){define("img",["require","surface"],function(e){var t,n,r,i,s;return r=e("surface"),t={},s=!1,i=function(e){return t[e.gamecsKey]=e},n=function(){function e(){}return e.load=function(e){var n,i,s,o;if(typeof e=="string"){s=t[e];if(!s)throw new Error('Missing "'+e+'", gamecs.preload() all images before trying to load them.')}else s=e;return n=document.createElement("canvas"),n.width=s.naturalWidth||s.width,n.height=s.naturalHeight||s.height,i=n.getContext("2d"),i.drawImage(s,0,0),s.getSize=function(){return[s.naturalWidth,s.naturalHeight]},o=new r(s.getSize()),o._canvas=n,o._context=i,o},e.init=function(){},e.preload=function(e){var t,n,r,o,u,a,f,l,c;t=0,n=0,a=function(){t++,t===n&&(s=!1);if(t%10===0)return console.log("gamecs.image: preloaded  "+t+" of "+n)},o=function(){return n>0?t/n:1},c=function(){return i(this),a()},r=function(){throw a(),new Error("Error loading "+this.src)};for(f in e){l=f.toLowerCase();if(l.indexOf(".png")===-1&&l.indexOf(".jpg")===-1&&l.indexOf(".jpeg")===-1&&l.indexOf(".svg")===-1&&l.indexOf(".gif")===-1)continue;u=new Image,u.addEventListener("load",c,!0),u.addEventListener("error",r,!0),u.src=e[f],u.gamecsKey=f,n++}return n>0&&(s=!0),o},e}()})}.call(this),function(){define("mask",["require","utils/objects","rect"],function(e){var t,n,r;return n=e("utils/objects"),r=e("rect"),t=function(){function t(e){var t,n,r,i,s,o;this.width=e[0],this.height=e[1],this._bits=[];for(t=r=0,s=this.width;0<=s?r<s:r>s;t=0<=s?++r:--r){this._bits[t]=[];for(n=i=0,o=this.height;0<=o?i<o:i>o;n=0<=o?++i:--i)this._bits[t][n]=!1}return}var e;return t.fromSurface=function(e,n){var r,i,s,o,u,a,f,l,c;n=n&&255-n||255,o=e.getImageData().data,i=e.getSize(),u=new t(i);for(s=l=0,c=o.length;l<=c;s=l+=4)f=parseInt(s/4/i[0],10),a=parseInt(s/4%i[0],10),r=o[s+3],r>=n&&u.setAt(a,f);return u},t.prototype.overlapRect=function(e,t){var n,i,s,o,u,a;return n=this.rect,i=e.rect,t&&i.moveIp(t),i.collideRect(n)?(o=Math.max(n.left,i.left),s=Math.min(n.right,i.right),a=Math.max(n.top,i.top),u=Math.min(n.bottom,i.bottom),new r([o,a],[s-o,u-a])):null},t.prototype.overlap=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;s=this.overlapRect(e,t);if(s===null)return!1;n=this.rect,r=e.rect,t&&r.moveIp(t),i=0;for(u=a=l=s.top,c=s.bottom;l<=c?a<=c:a>=c;u=l<=c?++a:--a)for(o=f=h=s.left,p=s.right;h<=p?f<=p:f>=p;o=h<=p?++f:--f)if(this.getAt(o-n.left,u-n.top)&&e.getAt(o-r.left,u-r.top))return!0;return!1},t.prototype.overlapArea=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;s=this.overlapRect(e,t);if(s===null)return 0;n=this.rect,r=e.rect,t&&r.moveIp(t),i=0;for(u=a=l=s.top,c=s.bottom;l<=c?a<=c:a>=c;u=l<=c?++a:--a)for(o=f=h=s.left,p=s.right;h<=p?f<=p:f>=p;o=h<=p?++f:--f)this.getAt(o-n.left,u-n.top)&&e.getAt(o-r.left,u-r.top)&&i++;return i},t.prototype.overlapMask=function(e,n){var r,i,s,o,u,a,f,l,c,h,p,d;o=this.overlapRect(e,n);if(o===null)return 0;r=this.rect,i=e.rect,n&&i.moveIp(n),s=new t([o.width,o.height]);for(a=f=c=o.top,h=o.bottom;c<=h?f<=h:f>=h;a=c<=h?++f:--f)for(u=l=p=o.left,d=o.right;p<=d?l<=d:l>=d;u=p<=d?++l:--l)this.getAt(u-r.left,a-r.top)&&e.getAt(u-i.left,a-i.top)&&s.setAt(u,a);return s},t.prototype.setAt=function(e,t){return this._bits[e][t]=!0},t.prototype.getAt=function(e,t){return e=parseInt(e,10),t=parseInt(t,10),e<0||t<0||e>=this.width||t>=this.height?!1:this._bits[e][t]},t.prototype.invert=function(){return this._bits=this._bits.map(function(e){return e.map(function(e){return!e})})},e=function(){return[this.width,this.height]},n.accessors(t.prototype,{rect:{get:function(){return new r([0,0],[this.width,this.height])}},length:{get:function(){var e;return e=0,this._bits.forEach(function(t){return t.forEach(function(t){if(t)return e++})}),e}}}),t}()})}.call(this),function(){define("mixer",["require"],function(e){var t;return t=function(){function t(){}var e;return t.CACHE={},t._PRELOADING=!1,t.NUM_CHANNELS=8,t.setNumChannels=function(e){return this.NUM_CHANNELS=parseInt(e,10)||this.NUM_CHANNELS},t.getNumChannels=function(){return this.NUM_CHANNELS},t.init=function(){var e;e=Array.prototype.slice.call(document.getElementsByTagName("audio"),0),this.addToCache(e)},t.preload=function(e,t){var n,r,i,s,o,u,a,f;i=0,r=0,u=function(){r++;if(r===i)return this._PRELOADING=!1},o=function(){return i>0?r/i:1},f=function(){return this.addToCache(this),u()},s=function(){throw u(),new Error("Error loading "+this.src)};for(a in e){if(a.indexOf("wav")===-1&&a.indexOf("ogg")===-1&&a.indexOf("webm")===-1)continue;i++,n=new Audio,n.addEventListener("canplay",f,!0),n.addEventListener("error",s,!0),n.src=e[a],n.gamecsKey=a,n.load()}return i>0&&(this._PRELOADING=!0),o},t.isPreloading=function(){return this._PRELOADING},t.addToCache=function(e){var t;e instanceof Array||(e=[e]),t=document.location.href,e.forEach(function(e){return this.CACHE[e.gamecsKey]=e})},e=function(){function e(e){var t,n,r,i;n=typeof e=="string"?this.CACHE[e]:e;if(!n)throw new Error('Missing "'+e+'", gamecs.preload() all audio files before loading');r=[],i=NUM_CHANNELS;while(i-->0)t=new Audio,t.preload="auto",t.loop=!1,t.src=n.src,r.push(t)}return e.prototype.play=function(e){return channels.some(function(t){return t.ended||t.paused?(t.loop=!!e,t.play(),!0):!1})},e.prototype.stop=function(){return channels.forEach(function(e){return e.stop()})},e.prototype.setVolume=function(e){return channels.forEach(function(t){return t.volume=e})},e.prototype.getVolume=function(){return channels[0].volume},e.prototype.getLength=function(){return channels[0].duration},e}(),t}()})}.call(this),function(){define("utils/arrays",["require"],function(e){var t;return t=function(){function e(){}return e.remove=function(e,t){var n;return n=t.indexOf(e),n!==-1?t.splice(t.indexOf(e),1):null},e.shuffle=function(e){var t,n,r,i,s;i=e.length(-1);for(t=s=i;i<=0?s<=0:s>=0;t=i<=0?++s:--s)n=parseInt(Math.random()*(t+1)),r=e[t],e[t]=e[n],e[n]=r;return e},e}()})}.call(this),function(){define("utils/geometry",["require"],function(e){var t;return t=function(){function e(){}return e.normaliseDegrees=function(e){return e%=360,e<0&&(e+=360),e},e.normaliseRadians=function(e){return e%=2*Math.PI,e<0&&(e+=2*Math.PI),e},e.degrees=function(e){return e*(180/Math.PI)},e.radians=function(e){return e*(Math.PI/180)},e.centroid=function(){var e,t,n;return e=Array.prototype.slice.apply(arguments,[0]),t=[0,0],e.forEach(p,t[0]+=parseInt(p[0],10),t[1]+=parseInt(p[1],10)),n=e.length,[t[0]/n,t[1]/n]},e}()})}.call(this),function(){define("utils/vectors",["require","utils/geometry"],function(e){var t,n;return t=e("utils/geometry"),n=function(){function e(){}return e.distance=function(e,t){return this.len(this.subtract(e,t))},e.subtract=function(e,t){return[e[0]-t[0],e[1]-t[1]]},e.add=function(e,t){return[e[0]+t[0],e[1]+t[1]]},e.multiply=function(e,t){return typeof t=="number"?[e[0]*t,e[1]*t]:[e[0]*t[0],e[1]*t[1]]},e.divide=function(e,t){if(typeof t=="number")return[e[0]/t,e[1]/t];throw new Error("only divide by scalar supported")},e.len=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},e.unit=function(e){var t;return t=this.len(e),t?[e[0]/t,e[1]/t]:[0,0]},e.rotate=function(e,n){return n=t.normaliseRadians(n),[e[0]*Math.cos(n)-e[1]*Math.sin(n),e[0]*Math.sin(n)+e[1]*Math.cos(n)]},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},e.angle=function(e,t){var n,r,i;return n=Math.atan2(e[0],e[1]),r=Math.atan2(t[0],t[1]),i=n-r,(i-Math.floor((i+Math.PI)/(2*Math.PI))*2*Math.PI-2*Math.PI)%(Math.PI*2)},e.truncate=function(e,t){return this.len(e)>t?this.multiply(this.unit(e),t):e},e}()})}.call(this),function(){define("sprite",["require","utils/arrays","utils/objects","utils/vectors"],function(e){var t,n,r,i;return t=e("utils/arrays"),n=e("utils/objects"),i=e("utils/vectors"),r=function(){function e(){n.accessor(this,"groups",function(){return this._groups})}return e.prototype._groups=[],e.prototype._alive=!0,e.image=null,e.rect=null,e.prototype.kill=function(){return this._alive=!1,this._groups.forEach(function(e){return e.remove(this)},this)},e.prototype.remove=function(e){return e instanceof Array||(e=[e]),e.forEach(function(e){return e.remove(this)},this)},e.prototype.add=function(e){return e instanceof Array||(e=[e]),e.forEach(function(e){return e.add(this)},this)},e.prototype.groups=function(){return this._groups.slice(0)},e.prototype.draw=function(e){return e.blit(this.image,this.rect)},e.prototype.update=function(){},e.prototype.isDead=function(){return!this._alive},e}()})}.call(this),function(){define("group",["require","sprite"],function(e){var t,n;return n=e("sprite"),t=function(){function e(){this._sprites=[],(arguments[0]instanceof n||arguments[0]instanceof Array&&arguments[0].length&&arguments[0][0]instanceof n)&&this.add(arguments[0])}return e.prototype.update=function(){var e;return e=arguments,this._sprites.forEach(function(t){return t.update.apply(t,e)},this)},e.prototype.add=function(e){return e instanceof Array||(e=[e]),e.forEach(function(e){return this._sprites.push(e),e._groups.push(this)},this)},e.prototype.remove=function(e){e instanceof Array||(e=[e]),e.forEach(function(e){return Arrays.remove(e,this._sprites),Arrays.remove(this,e._groups)},this)},e.prototype.has=function(e){return e instanceof Array||(e=[e]),e.every(function(e){return this._sprites.indexOf(e)!==-1},this)},e.prototype.sprites=function(){return this._sprites},e.prototype.draw=function(){var e;e=arguments,this._sprites.forEach(function(t){return t.draw.apply(t,e)},this)},e.prototype.clear=function(e,t){return this._sprites.forEach(function(n){return e.blit(t,n.rect)},this)},e.prototype.empty=function(){this._sprites=[]},e.prototype.collidePoint=function(){var e;return e=Array.prototype.slice.apply(arguments),this._sprites.filter(function(t){return t.rect.collidePoint.apply(t.rect,e)},this)},e.prototype.forEach=function(e,t){return this._sprites.forEach(e,t)},e.prototype.some=function(e,t){return this._sprites.some(e,t)},e.spriteCollide=function(e,t,n,r){var i;return r=r||collideRect,n=n||!1,i=[],t.sprites().forEach(function(t){if(r(e,t))return n&&t.kill(),i.push(t)}),i},e.groupCollide=function(e,t,n,r,i){var s,o;return n=n||!1,r=r||!1,o=[],s=i||collideRect,e.sprites().forEach(function(e){return t.sprites().forEach(function(t){if(s(e,t))return n&&e.kill(),r&&t.kill(),o.push({a:e,b:t})})}),o},e.collideRect=function(e,t){return e.rect.collideRect(t.rect)},e.collideMask=function(e,t){var n;if(!e.mask||!t.mask)throw new Error("Both sprites must have 'mask' attribute set to an gamecs.mask.Mask");return n=[t.rect.left-e.rect.left,t.rect.top-e.rect.top],e.mask.overlap(t.mask,n)},e.collideCircle=function(e,t){var n,r;return n=e.radius||Math.max(e.rect.width,e.rect.height),r=t.radius||Math.max(t.rect.width,t.rect.height),Vector.distance(e.rect.center,t.rect.center)<=n+r},e}()})}.call(this),function(){define("time",["require"],function(e){var t,n,r,i,s,o,u,a;return i=null,t={},n={},r=null,o=function(){var e,r,i,s,o,u;s=Date.now(),i=n,e=function(e){return e.callback(o)},u=[];for(r in i)i[r]||(n[r]=s),o=s-i[r],r<=o?(n[r]=s,u.push(t[r].forEach(e,this))):u.push(void 0);return u},a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null,u=function(){return o(),a(u)},s=function(){function e(){}return e.init=function(){return this.STARTTIME=Date.now(),a?a(u):setInterval(o,10)},e.interval=function(e,t,n){return n===void 0&&isNaN(t)&&(n=t,t=void 0),this.fpsCallback(e,n,t)},e.fpsCallback=function(e,r,i){return i===void 0&&(i=60),i=parseInt(1e3/i,10),t[i]=t[i]||[],n[i]=n[i]||0,t[i].push({rawFn:e,callback:function(t){return e.apply(r,[t])}})},e.deleteCallback=function(e,n){var r,i;return i=null,n=parseInt(1e3/n,10),r=t[n],r&&(t[n]=r.filter(function(t,n){return i=t.rawFn!==e})),i},e}()})}.call(this),function(){define("base64",["require"],function(e){var t;return t=function(){function e(){}return e.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.decode=function(e){var t,n,r,i,s,o,u,a,f;f=[],a=0,e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(a<e.length)i=keyStr.indexOf(e.charAt(a++)),s=keyStr.indexOf(e.charAt(a++)),o=keyStr.indexOf(e.charAt(a++)),u=keyStr.indexOf(e.charAt(a++)),t=i<<2|s>>4,n=(s&15)<<4|o>>2,r=(o&3)<<6|u,f.push(String.fromCharCode(t)),o!==64&&f.push(String.fromCharCode(n)),u!==64&&f.push(String.fromCharCode(r));return f=f.join(""),f},e.decodeAsArray=function(e,t){var n,r,i,s,o,u,a,f,l;t=t||1,r=this.decode(e),o=r.length/t,n=[];for(i=u=0,f=o-1;0<=f?u<=f:u>=f;i=0<=f?++u:--u){n[i]=0;for(s=a=l=t-1;l<=0?a<=0:a>=0;s=l<=0?++a:--a)n[i]+=r.charCodeAt(i*t+s)<<(s<<3)}return n},e}()})}.call(this),function(){define("xml",["require"],function(e){var t;return t=function(){function t(){var e,t;t=null,e=new DOMParser,this.parseFromString=function(n){return t=e.parseFromString(n,"text/xml"),t}}var e;return e=function(){function e(e){if(!e||!e instanceof XMLDocument)throw new Error("Need a valid xmlDocument.");return this._xmlDocument=e,this}return e.prototype.element=function(t){var n;return n=this._xmlDocument.getElementsByTagName(t)[0],n&&new e(n)||null},e.prototype.elements=function(t){var n;return n=this._xmlDocument.getElementsByTagName(t),Array.prototype.slice.apply(n,[0]).map(function(t){return new e(t)})},e.prototype.attribute=function(e){var t,n,r;return r=this._xmlDocument.getAttribute(e),r=r?r.trim():null,r===null?null:r.toLowerCase()==="true"?!0:r.toLowerCase()==="false"?!1:(n=parseInt(r,10),t=parseFloat(r,10),isNaN(n)?r:t!==n?t:n)},e.prototype.value=function(){return this._xmlDocument.nodeValue},e.prototype.children=function(){return Array.prototype.slice.apply(this._xmlDocument.childNodes,[0]).map(function(t){return new e(t)})},e.prototype.fromString=function(t){var n,r;return n=new DOMParser,r=n.parseFromString(t,"text/xml"),new e(r)},e.prototype.fromURL=function(t){var n;return n=new XMLHttpRequest,n.open("GET",t,!1),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-Type","text/xml"),n.overrideMimeType("text/xml"),n.send(),new e(n.responseXML)},e}(),t}()})}.call(this),function(){define("utils/matrix",["require"],function(e){var t;return t=function(){function e(){}return e.identity=function(){return[1,0,0,1,0,0]},e.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6]]},e.multiply=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.add2=function(e,t){var n,r,i,s,o,u,a;e[0]instanceof Array||(e=[e]),t[0]instanceof Array||(t=[t]);if(e.length!==t.length&&e[0].length!==t[0].length)throw"error: incompatible sizes";i=[];for(n=s=0,u=e.length;0<=u?s<u:s>u;n=0<=u?++s:--s){i[n]=[];for(r=o=0,a=e[0].length;0<=a?o<a:o>a;r=0<=a?++o:--o)i[n][r]=e[n][r]+t[n][r]}return i},e.multiply2=function(e,t){var n,r,i,s,o,u,a,f;e[0]instanceof Array||(e=[e]),t[0]instanceof Array||(t=t.map(function(e){return[e]}));if(e[0].length!==t.length)throw"error: incompatible sizes";s=[],f=[];for(n=u=0,a=e.length;0<=a?u<a:u>a;n=0<=a?++u:--u)s[n]=[],f.push(function(){var u,a,f,l,c;c=[];for(r=u=0,f=t[0].length;0<=f?u<f:u>f;r=0<=f?++u:--u){o=0;for(i=a=0,l=e[0].length;0<=l?a<l:a>l;i=0<=l?++a:--a)o+=e[n][i]*t[i][r];c.push(s[n][r]=o)}return c}());return f},e.translate=function(t,n,r){return e.multiply(t,[1,0,0,1,n,r])},e.rotate=function(t,n){var r,i;return i=Math.sin(n),r=Math.cos(n),e.multiply(t,[r,i,-i,r,0,0])},e.rotation=function(e){return Math.atan2(e[1],e[0])},e.scale=function(t,n){var r,i;return r=n[0],i=n[1],e.multiply(t,[r,0,0,i,0,0])},e}()})}.call(this),function(){define("transform",["require","rect","utils/matrix","utils/vectors","surface"],function(e){var t,n,r,i,s;return n=e("rect"),t=e("utils/matrix"),s=e("utils/vectors"),r=e("surface"),i=function(){function e(){}return e.rotate=function(e,n){var i,o,u,a,f,l,c,h,p,d,v,m,g,y,b;return c=e.getSize(),p=n*Math.PI/180,u=c,n%360!==0&&(d=e.getRect(),h=[[-d.width/2,d.height/2],[d.width/2,d.height/2],[-d.width/2,-d.height/2],[d.width/2,-d.height/2]],m=h.map(function(e){return s.rotate(e,p)}),y=m.map(function(e){return e[0]}),b=m.map(function(e){return e[1]}),o=Math.min.apply(Math,y),v=Math.max.apply(Math,y),i=Math.min.apply(Math,b),g=Math.max.apply(Math,b),u=[v-o,g-i]),a=new r(u),l=e._matrix,e._matrix=t.translate(e._matrix,c[0]/2,c[1]/2),e._matrix=t.rotate(e._matrix,p),e._matrix=t.translate(e._matrix,-c[0]/2,-c[1]/2),f=[(u[0]-c[0])/2,(u[1]-c[1])/2],a.blit(e,f),e._matrix=l,a},e.scale=function(e,n){var i,s,o,u,a,f,l;f=n[0],i=n[1];if(f<=0||i<=0)throw new Error("[gamecs.transform.scale] Invalid arguments for height and width",[f,i]);return u=e.getSize(),l=f/u[0],s=i/u[1],o=new r([f,i]),a=e._matrix.slice(0),e._matrix=t.scale(e._matrix,[l,s]),o.blit(e),e._matrix=a,o},e.flip=function(e,t,n){var i,s,o,u,a,f;return i=e.getSize(),s=new r(i),o=1,u=1,a=0,f=0,t===!0&&(o=-1,a=-i[0]),n===!0&&(u=-1,f=-i[1]),s.context.save(),s.context.scale(o,u),s.context.drawImage(e.canvas,a,f),s.context.restore(),s},e}()})}.call(this),function(){define("simplex",["require"],function(e){var t;return t=function(){function e(e){var t,n,r;e===void 0&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(t=n=0;n<256;t=++n)this.p[t]=Math.floor(e.random()*256);this.perm=[];for(t=r=0;r<512;t=++r)this.perm[t]=this.p[t&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}return e.prototype.dot=function(e,t,n){return e[0]*t+e[1]*n},e.prototype.get=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L;return n=.5*(Math.sqrt(3)-1),y=(e+t)*n,f=Math.floor(e+y),h=Math.floor(t+y),r=(3-Math.sqrt(3))/6,b=(f+h)*r,i=f-b,s=h-b,x=e-i,C=t-s,x>C?(l=1,p=0):(l=0,p=1),T=x-l+r,k=C-p+r,N=x-1+2*r,L=C-1+2*r,c=f&255,d=h&255,o=this.perm[c+this.perm[d]]%12,u=this.perm[c+l+this.perm[d+p]]%12,a=this.perm[c+1+this.perm[d+1]]%12,w=.5-x*x-C*C,w<0?v=0:(w*=w,v=w*w*this.dot(this.grad3[o],x,C)),E=.5-T*T-k*k,E<0?m=0:(E*=E,m=E*E*this.dot(this.grad3[u],T,k)),S=.5-N*N-L*L,S<0?g=0:(S*=S,g=S*S*this.dot(this.grad3[a],N,L)),70*(v+m+g)},e.prototype.get3d=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X;return r=1/3,A=(e+t+n)*r,p=Math.floor(e+A),g=Math.floor(t+A),E=Math.floor(n+A),i=1/6,O=(p+g+E)*i,s=p-O,o=g-O,u=E-O,H=e-s,F=t-o,U=n-u,H>=F?F>=U?(d=1,y=0,S=0,v=1,b=1,x=0):H>=U?(d=1,y=0,S=0,v=1,b=0,x=1):(d=0,y=0,S=1,v=1,b=0,x=1):F<U?(d=0,y=0,S=1,v=0,b=1,x=1):H<U?(d=0,y=1,S=0,v=0,b=1,x=1):(d=0,y=1,S=0,v=1,b=1,x=0),a=1/(6..x1=H-d+i),I=F-y+i,z=U-S+i,B=H-v+2*i,q=F-b+2*i,W=U-x+2*i,j=H-1+3*i,R=F-1+3*i,X=U-1+3*i,m=p&255,w=g&255,T=E&255,f=this.perm[m+this.perm[w+this.perm[T]]]%12,l=this.perm[m+d+this.perm[w+y+this.perm[T+S]]]%12,c=this.perm[m+v+this.perm[w+b+this.perm[T+x]]]%12,h=this.perm[m+1+this.perm[w+1+this.perm[T+1]]]%12,M=.6-H*H-F*F-U*U,M<0?N=0:(M*=M,N=M*M*this.dot(this.grad3[f],H,F,U)),_=.6-x1*x1-I*I-z*z,_<0?C=0:(_*=_,C=_*_*this.dot(this.grad3[l],x1,I,z)),D=.6-B*B-q*q-W*W,D<0?k=0:(D*=D,k=D*D*this.dot(this.grad3[c],B,q,W)),P=.6-j*j-R*R-X*X,P<0?L=0:(P*=P,L=P*P*this.dot(this.grad3[h],j,R,X)),32*(N+C+k+L)},e}()})}.call(this),function(){define("spritesheet",["require","surface","rect"],function(e){var t,n,r;return r=e("surface"),t=e("rect"),n=function(){function n(){}var e;return e=[],n.prototype.get=function(t){return e[t]},n.prototype.load=function(n,i){var s,o,u,a,f,l,c,h,p,d,v;c=i[0],s=i[1],o=new t([0,0],i),u=Math.floor(n.rect.width/c),a=Math.floor(n.rect.height/s),v=[];for(p=d=0;0<=a?d<a:d>a;p=0<=a?++d:--d)v.push(function(){var a,d;d=[];for(h=a=0;0<=u?a<u:a>u;h=0<=u?++a:--a)l=new r(i),f=new t(h*c,p*s,c,s),l.blit(n,o,f),d.push(e.push(l));return d}());return v},n}()})}.call(this),function(){define("tilemap",["require","surface","img","rect","spritesheet"],function(e){var t,n,r,i,s;return i=e("surface"),t=e("img"),n=e("rect"),r=e("spritesheet"),s=function(){function c(e,n){var i,s,o,u,a,f,l,c;n=n||{},this.width=e.width,this.height=e.height,this.tileWidth=e.tilewidth,this.tileHeight=e.tileheight,this.size=[this.width*this.tileWidth,this.height*this.tileHeight];if(e.tilesets){this.tileSheet=new r,this.tileSheet.firstgid=e.tilesets[0].firstgid,l=e.tilesets;for(u=0,f=l.length;u<f;u++)o=l[u],s=t.load(o.image),this.tileSheet.load(s,[o.tilewidth,o.tileheight])}if(e.layers){this.collisionLayerName=n.collisionLayerName||"collision",this.layers={};for(i=a=0,c=e.layers.length;0<=c?a<c:a>c;i=0<=c?++a:--a)this.layers[e.layers[i].name]=e.layers[i]}}var e,s,o,u,a,f,l;return f=null,e=null,a=null,o=null,s=null,u=null,c.prototype.gid2pos=function(e){var t,n,r;return e-=1,t=function(e,t){return e%t===0?t-1:e%t-1},n=e===0?0:t(e+1,this.width),r=Math.floor(e/this.width),[n*this.tileWidth,r*this.tileHeight]},c.prototype.gid2rect=function(e){return new gamecs.Rect(this.gid2pos(e),[this.tileWidth,this.tileHeight])},c.prototype.pos2gid=function(e,t){return e=Math.floor(e/this.tileWidth),t=Math.floor(t/this.tileHeight),t*this.width+e},c.prototype.getTile=function(e){return this.tileSheet.get(e-this.tileSheet.firstgid)},c.prototype.isOutOfBounds=function(e,t){return e<=0||e>=this.size[0]||t<=0||t>=this.size[1]},l=function(e,t,n){return n===void 0&&(n=this.collisionLayerName),this.isOutOfBounds(e,t)?!0:!!this.layers[this.collisionLayerName].data[this.pos2gid(e,t)]},c.prototype.isColliding=function(e){return l(e.left,e.top)||l(e.left+e.width,e.top)||l(e.left,e.top+e.height)||l(e.left+e.width,e.top+e.height)},c.prototype.getTiles=function(){var e;return e=[],e},c.prototype.prepareLayers=function(){var e,t,r,s,o,u,a,f,l,c,h,p,d;d=[];for(r in this.layers){s=this.layers[r];if(s.properties===void 0||s.properties.visible!==!1){u=new i(this.size[0],this.size[1]);for(f=l=0,h=this.height;0<=h?l<h:l>h;f=0<=h?++l:--l)for(a=c=0,p=this.width;0<=p?c<p:c>p;a=0<=p?++c:--c)o=new n(a*this.tileWidth,f*this.tileHeight,this.tileWidth,this.tileHeight),e=s.data[f*this.width+a],e!==0&&(e?(t=this.getTile(e),u.blit(t,o)):console.log("bug",a,f,e));d.push(this.layers[r].image=u)}else d.push(void 0)}return d},c}()})}.call(this),function(){define("utils/uri",["require"],function(e){var t;return t=function(){function e(){}return e.URI_REGEX=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),e.resolve=function(e,t){var n,r,i,s,o;return s=this.match(e),o=this.match(t),r=s[1]+"://"+s[3],o[1]?t:(s[4]&&(r=r+":"+s[4]),n=s[5],t.charAt(0)!=="/"?(i=n.lastIndexOf("/"),n=n.substr(0,i+1)+t):n=t,r+this.removeDotSegments(n))},e.match=function(e){return e.match(this.URI_REGEX)},e.makeRelative=function(e){var t;return t=this.resolve(document.location.href,"./"),e.indexOf(t)===0&&(e="./"+e.substring(t.length)),e},e.removeDotSegments=function(e){var t,n,r,i,s,o,u;if(e===".."||e===".")return"";t=e.indexOf("/")>-1,s=e.split("/"),n=[""];for(r=o=1,u=s.length;1<=u?o<=u:o>=u;r=1<=u?++o:--o){i=s[r];if(i===void 0||i===".")continue;i===".."?((n.length>1||n.length===1&&n[0]!=="")&&n.pop(),t&&r===s.length&&n.push("")):(n.push(i),t=!0)}return n.join("/")},e}()})}.call(this),function(){var e=[].slice;define("gamecs",["require","display","draw","key","font","http","img","mask","mixer","sprite","group","time","base64","xml","rect","transform","simplex","tilemap","utils/uri"],function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;return r=["info","warn","error","fatal"],E=2,S={},p={},S.setLogLevel=function(e){if(typeof e=="string"&&r.indexOf(e))E=r.indexOf(e);else{if(typeof e!="number")throw new Error("invalid logLevel ",e," Must be one of: ",r);E=e}return E},S.info=function(){var t;t=1<=arguments.length?e.call(arguments,0):[];if(E<=r.indexOf("info"))return log.apply(this,t)},S.warn=function(){var t;t=1<=arguments.length?e.call(arguments,0):[];if(E<=r.indexOf("warn"))return log.apply(this,t)},S.error=function(){var t;t=1<=arguments.length?e.call(arguments,0):[];if(E<=r.indexOf("error"))return log.apply(this,t)},S.fatal=function(){var t;t=1<=arguments.length?e.call(arguments,0):[];if(E<=r.indexOf("fatal"))return log.apply(this,t)},i=S.Display=t("display"),s=S.Draw=t("draw"),l=S.Key=t("key"),o=S.Font=t("font"),a=S.Http=t("http"),f=S.Img=t("img"),c=S.Mask=t("mask"),h=S.Mixer=t("mixer"),m=S.Sprite=t("sprite"),u=S.Group=t("group"),y=S.Time=t("time"),n=S.Base64=t("base64"),w=S.Xml=t("xml"),d=S.Rect=t("rect"),b=S.Transform=t("transform"),v=S.Simplex=t("simplex"),g=S.TileMap=t("tilemap"),S.ready=function(e){var t,n,r,s,o;return r=null,t=null,y.init(),s=function(){if(!document.body)return window.setTimeout(s,50);t=f.preload(p);try{r=h.preload(p)}catch(e){console.log("Error loading audio files ",e)}return window.setTimeout(o,50)},o=function(){return t()<1||r()<1?window.setTimeout(o,100):(i.init(),f.init(),h.init(),l.init(),e())},window.setTimeout(s,13),n=function(){return t?.5*t()+.5*r():.1},n},x=function(){var e;return e={},["Time","Display","Img","Mixer","Key"].forEach(function(t){try{return this[t].init()}catch(n){return e[t]=n.toString()}}),e},N=function(){return window.$g&&window.$g.resourceBaseHref||document.location.href},T=S.preload=function(e){var n,r;return r=t("utils/uri"),n=N(),e.forEach(function(e){return p[e]=r.resolve(n,e)},this)},S})}.call(this);